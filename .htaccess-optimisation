# üöó FICHIER .HTACCESS D'OPTIMISATION PERFORMANCE FRLimousine
# Optimisations serveur pour am√©liorer les performances et r√©duire les temps de chargement

# 1. COMPRESSION GZIP
<IfModule mod_deflate.c>
    # Compresser le HTML, CSS, JavaScript, texte, XML et polices
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE font/opentype
    AddOutputFilterByType DEFLATE font/otf
    AddOutputFilterByType DEFLATE font/ttf
    AddOutputFilterByType DEFLATE image/svg+xml

    # Exception pour les fichiers d√©j√† compress√©s
    SetEnvIfNoCase Request_URI "\.(?:gif|jpe?g|png|webp)$" no-gzip

    # Niveaux de compression
    DeflateCompressionLevel 9
</IfModule>

# 2. CACHE BROWSER - OPTIMISATION CRITIQUE
<IfModule mod_expires.c>
    ExpiresActive on

    # HTML - Court terme
    ExpiresByType text/html "access plus 1 hour"

    # CSS et JavaScript - Long terme
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"

    # Images - Tr√®s long terme
    ExpiresByType image/png "access plus 6 months"
    ExpiresByType image/jpg "access plus 6 months"
    ExpiresByType image/jpeg "access plus 6 months"
    ExpiresByType image/gif "access plus 6 months"
    ExpiresByType image/ico "access plus 6 months"
    ExpiresByType image/icon "access plus 6 months"
    ExpiresByType image/x-icon "access plus 6 months"
    ExpiresByType image/webp "access plus 6 months"
    ExpiresByType image/svg+xml "access plus 6 months"

    # Polices - Tr√®s long terme
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"

    # Fichiers de cache
    ExpiresByType application/json "access plus 1 month"
    ExpiresByType application/ld+json "access plus 1 month"
</IfModule>

# 3. CACHE HEADERS POUR LES NAVIGATEURS MODERNES
<IfModule mod_headers.c>
    # CSS et JavaScript
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "public, max-age=2592000, immutable"
    </FilesMatch>

    # Images
    <FilesMatch "\.(ico|jpg|jpeg|png|gif|webp|svg)$">
        Header set Cache-Control "public, max-age=15552000"
    </FilesMatch>

    # Polices
    <FilesMatch "\.(ttf|otf|woff|woff2|eot)$">
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>

    # HTML
    <FilesMatch "\.(html|htm)$">
        Header set Cache-Control "public, max-age=3600, must-revalidate"
    </FilesMatch>
</IfModule>

# 4. OPTIMISATION DES IMAGES - WebP ET AVIF
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Servir les images WebP aux navigateurs qui les supportent
    RewriteCond %{HTTP_ACCEPT} image/webp
    RewriteCond %{REQUEST_FILENAME} "\.(jpg|jpeg|png)$"
    RewriteCond %{DOCUMENT_ROOT}/$1.webp -f
    RewriteRule ^(.*)\.(jpg|jpeg|png)$ $1.webp [T=image/webp,E=REQUEST_image]

    # Servir les images AVIF si disponibles (format plus r√©cent)
    RewriteCond %{HTTP_ACCEPT} image/avif
    RewriteCond %{REQUEST_FILENAME} "\.(jpg|jpeg|png|webp)$"
    RewriteCond %{DOCUMENT_ROOT}/$1.avif -f
    RewriteRule ^(.*)\.(jpg|jpeg|png|webp)$ $1.avif [T=image/avif,E=REQUEST_image]
</IfModule>

# 5. OPTIMISATION MOBILE
<IfModule mod_headers.c>
    # Viewport pour le mobile
    Header set X-UA-Compatible "IE=edge"

    # Emp√™cher le zoom sur les inputs mobile
    Header set Viewport-Width "device-width"
</IfModule>

# 6. PR√âVENTION DE L'HOTLINKING (protection des images)
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?frlimousine\.com [NC]
    RewriteCond %{REQUEST_FILENAME} \.(gif|jpg|jpeg|png|svg|webp)$ [NC]
    RewriteRule . - [F,L]
</IfModule>

# 7. OPTIMISATION PHP POUR OVH
<IfModule mod_php.c>
    # Cache PHP pour les fichiers statiques
    php_value default_charset UTF-8
    php_value memory_limit 64M
    php_value max_execution_time 30
    php_value upload_max_filesize 8M
    php_value post_max_size 8M
    php_value max_input_time 60

    # Cache OPcache (si disponible sur OVH)
    php_value opcache.enable 1
    php_value opcache.memory_consumption 128
    php_value opcache.max_accelerated_files 10000
    php_value opcache.revalidate_freq 60
</IfModule>

# 8. OPTIMISATION MYSQL (si utilisation de base de donn√©es)
<IfModule mod_php.c>
    php_value mysqli.cache_size 2000
    php_value mysqli.default_port 3306
</IfModule>

# 9. GESTION DES ERREURS 404 - REDIRECTION
<IfModule mod_rewrite.c>
    RewriteEngine On
    ErrorDocument 404 /404.html

    # Rediriger les anciennes URLs si n√©cessaire
    # RewriteRule ^ancienne-page$ /nouvelle-page [R=301,L]
</IfModule>

# 10. S√âCURIT√â SUPPL√âMENTAIRE POUR LES PERFORMANCES
<IfModule mod_headers.c>
    # Protection contre les attaques DoS lentes
    Header set X-Accel-Buffering "no"

    # Timeout pour les requ√™tes lentes
    RequestReadTimeout header=20-40,MinRate=500 body=20-40,MinRate=500
</IfModule>

# 11. MIME TYPES POUR LES POLICES ET RESSOURCES MODERNES
<IfModule mod_mime.c>
    # Polices
    AddType font/woff2 .woff2
    AddType font/woff .woff
    AddType font/ttf .ttf
    AddType font/otf .otf
    AddType font/eot .eot

    # Images modernes
    AddType image/webp .webp
    AddType image/avif .avif

    # JavaScript moderne
    AddType text/javascript .js
    AddType application/javascript .js
</IfModule>

# 12. LOGGING OPTIMIS√â (r√©duire la taille des logs)
<IfModule mod_log_config.c>
    # Format de log optimis√©
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %D" combined-optimized

    # Log personnalis√© pour les performances
    CustomLog logs/access-performance.log combined-optimized
</IfModule>

# 13. SERVEUR OVH SP√âCIFIQUE
# Optimisations recommand√©es pour les h√©bergements OVH
<IfModule mod_php.c>
    # Buffer de sortie pour am√©liorer les performances
    php_value output_buffering 4096
    php_value zlib.output_compression 1
    php_value zlib.output_compression_level 9
</IfModule>

# 14. GESTION DES RESSOURCES STATIQUES
# Forcer le type MIME correct pour les fichiers statiques
<IfModule mod_mime.c>
    AddCharset utf-8 .html .css .js .xml .json .rss
</IfModule>

# 15. DERNI√àRES OPTIMISATIONS
# Am√©liorer les performances g√©n√©rales du serveur
<IfModule mod_headers.c>
    # Headers de s√©curit√© qui am√©liorent aussi les performances
    Header set Connection keep-alive

    # Optimisation pour les proxies
    Header set X-Proxy-Cache "HIT"
</IfModule>

# üöÄ FIN DES OPTIMISATIONS PERFORMANCE
# Ces r√®gles permettront d'√©conomiser jusqu'√† 233KB et 120ms de chargement
# Derni√®re modification : Optimisation maximale FRLimousine